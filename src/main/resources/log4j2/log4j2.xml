<?xml version="1.0" encoding="UTF-8" ?>
<Configuration>
	<Appenders>
		<RollingFile name="events-out" fileName="${sys:logPath}/events.log"
			filePattern="${sys:logPath}/events-%d{yyyy-MM}/events-%d{yyyy-MM-dd}-%i.log.xz" immediateFlush="false" bufferSize="131072">
			<PatternLayout pattern="%d{yyyy.MM.dd HH:mm:ss} %m%n" />
			<Policies>
				<SizeBasedTriggeringPolicy size="128 MB" />
				<TimeBasedTriggeringPolicy />
			</Policies>
			<DefaultRolloverStrategy max="200">
			  <!-- Delete files older than 60 d -->
			  <Delete basePath="${sys:logPath}" maxDepth="2">
			    <IfFileName glob="events-*/events-*" />
			    <IfLastModified age="P60D" />
			  </Delete>
			</DefaultRolloverStrategy>
		</RollingFile>

		<RollingFile name="stats-out" fileName="${sys:logPath}/stats.log"
			filePattern="${sys:logPath}/stats-%d{yyyy-MM}/stats-%d{yyyy-MM-dd}.log.xz">
			<ThresholdFilter level="debug" onMatch="accept"
				onMismatch="deny" />
			<PatternLayout pattern="%d{yyyy.MM.dd HH:mm:ss} %c - %m%n" />
			<Policies>
				<TimeBasedTriggeringPolicy />
			</Policies>
			<DefaultRolloverStrategy max="200">
			  <!-- Delete files older than 60 d -->
			  <Delete basePath="${sys:logPath}" maxDepth="2">
			    <IfFileName glob="stats-*/stats-*" />
			    <IfLastModified age="P60D" />
			  </Delete>
			</DefaultRolloverStrategy>
		</RollingFile>
		
		<RollingFile name="debug-out" fileName="${sys:logPath}/debug.log"
			filePattern="${sys:logPath}/debug-%d{yyyy-MM}/debug-%d{yyyy-MM-dd}-%i.log.xz">
			<ThresholdFilter level="debug" onMatch="accept"
				onMismatch="deny" />
			<PatternLayout pattern="%d{yyyy.MM.dd HH:mm:ss} %c - %m%n" />
			<Policies>
				<SizeBasedTriggeringPolicy size="128 MB" />
				<TimeBasedTriggeringPolicy />
			</Policies>
			<DefaultRolloverStrategy max="200">
			  <!-- Delete files older than 7 d -->
			  <Delete basePath="${sys:logPath}" maxDepth="2">
			    <IfFileName glob="debug-*/debug-*" />
			    <IfLastModified age="P7D" />
			  </Delete>
			</DefaultRolloverStrategy>
		</RollingFile>

		<RollingFile name="info-out" fileName="${sys:logPath}/info.log"
			filePattern="${sys:logPath}/info-%d{yyyy-MM}/info-%d{yyyy-MM-dd}-%i.log.xz">
			<ThresholdFilter level="info" onMatch="accept"
				onMismatch="deny" />
			<PatternLayout pattern="%d{yyyy.MM.dd HH:mm:ss} %c - %m%n" />
			<Policies>
				<SizeBasedTriggeringPolicy size="128 MB" />
				<TimeBasedTriggeringPolicy />
			</Policies>
			<DefaultRolloverStrategy max="200">
			  <!-- Delete files older than 60 d -->
			  <Delete basePath="${sys:logPath}" maxDepth="2">
			    <IfFileName glob="info-*/info-*" />
			    <IfLastModified age="P60D" />
			  </Delete>
			</DefaultRolloverStrategy>
		</RollingFile>

		<RollingFile name="warn-out" fileName="${sys:logPath}/warn.log"
			filePattern="${sys:logPath}/warn-%d{yyyy-MM}/warn-%d{yyyy-MM-dd}-%i.log.xz">
			<ThresholdFilter level="warn" onMatch="accept"
				onMismatch="deny" />
			<PatternLayout pattern="%d{yyyy.MM.dd HH:mm:ss} %c - %m%n" />
			<Policies>
				<SizeBasedTriggeringPolicy size="128 MB" />
				<TimeBasedTriggeringPolicy />
			</Policies>
			<DefaultRolloverStrategy max="200">
			  <!-- Delete files older than 60 d -->
			  <Delete basePath="${sys:logPath}" maxDepth="2">
			    <IfFileName glob="warn-*/warn-*" />
			    <IfLastModified age="P60D" />
			  </Delete>
			</DefaultRolloverStrategy>
		</RollingFile>

		<RollingFile name="error-out" fileName="${sys:logPath}/error.log"
			filePattern="${sys:logPath}/error-%d{yyyy-MM}/error-%d{yyyy-MM-dd}-%i.log.xz">
			<ThresholdFilter level="error" onMatch="accept"
				onMismatch="deny" />
			<PatternLayout pattern="%d{yyyy.MM.dd HH:mm:ss} %c - %m%n" />
			<Policies>
				<SizeBasedTriggeringPolicy size="128 MB" />
				<TimeBasedTriggeringPolicy />
			</Policies>
			<DefaultRolloverStrategy max="200">
			  <!-- Delete files older than 60 d -->
			  <Delete basePath="${sys:logPath}" maxDepth="2">
			    <IfFileName glob="error-*/error-*" />
			    <IfLastModified age="P60D" />
			  </Delete>
			</DefaultRolloverStrategy>
		</RollingFile>
	</Appenders>

	<Loggers>
		<AsyncLogger name="org.twinlife.web.ProxyEvent" level="info"
			additivity="false">
			<Appender-ref ref="events-out" />
		</AsyncLogger>

		<AsyncLogger name="org.twinlife" level="info"
			additivity="false">
			<Appender-ref ref="info-out" />
			<AppenderRef ref="warn-out" />
			<AppenderRef ref="error-out" />
		</AsyncLogger>

		<Root level="warn">
			<AppenderRef ref="warn-out" />
			<AppenderRef ref="error-out" />
		</Root>
	</Loggers>
</Configuration>
